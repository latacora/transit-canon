# transit-canon

Canonical serialization for Clojure data using Transit.

## Build & Test

```bash
bb test       # Run tests via Kaocha
bb lint       # Run clj-kondo linter
bb maint      # Check for outdated dependencies
```

Run tests after each change to verify nothing broke.

## Project Structure

- `src/com/latacora/transit_canon/core.clj` - Public API (`serialize`, `deserialize`, `canonical?`)
- `src/com/latacora/transit_canon/impl/` - Implementation details
  - `raw_emitter.clj` - Custom Transit emitter with raw JSON emission (gen-class, requires AOT)
  - `normalize.clj` - Number normalization and metadata stripping
  - `compress.clj` - Zstd compression utilities
- `classes/` - AOT-compiled classes (generated by `bb aot`)

## Build

The project uses gen-class for the custom Transit emitter, which requires AOT compilation:

```bash
bb aot        # AOT compile gen-class namespaces (auto-runs before tests)
```

## Style Guide

### Commits

Make small, meaningful commits. Each commit should represent one logical change.

### Optional Arguments

Pass optional arguments as a single options map, not as positional arguments.

Good:
```clojure
(defn serialize
  ([obj] (serialize obj {}))
  ([obj opts]
   (let [{:keys [compress? compression-level]} (merge defaults opts)]
     ...)))
```

Bad:
```clojure
(defn compress
  ([data] (compress data default-level))
  ([data compression-level]  ; positional optional - avoid this
   ...))
```
